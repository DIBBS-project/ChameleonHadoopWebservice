* ChameleonClusters

This project enables the deployment of clusters on the Chameleon infrastructure.
It is leveraging the *OpenStack API*,  the web framework *django* and the module
*django Rest framework* to build a REST API.

** Installation

The  project  contains  a  *requirements.txt* files  that  contains  all  python
dependencies required to  run the tool. To install all  the dependencies run the
following command:

#+BEGIN_src shell
pip install -r requirements.txt
#+END_src

** Getting started

*** Configure credentials

Edit the file located in conf/secret.py, so that he has the following content.

#+BEGIN_src python
secret = {
    "username": "YOUR_USERNAME",
    "password": "YOUR_PASSWORD",
    "project": "THE_NAME_OF_YOUR_PROJECT"
}
#+END_src

*** Initialise data

To initalise the database, run the following commands:

#+BEGIN_src shell
python manage.py makemigrations webservice
python manage.py syncdb
#+END_src

*** Start the web application

Run the following command from the project folder:

#+BEGIN_src shell
python manage.py runserver
#+END_src

You should get the following output:

#+BEGIN_src shell
Performing system checks...

System check identified no issues (0 silenced).
March 23, 2016 - 20:38:56
Django version 1.8, using settings 'webservice.settings'
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
#+END_src

** Accessing the API
*** Browser
Accessing the  "http://127.0.0.1:8000/sites" in  a browser  should lead  to the
following web page:

[[./docs/sites_browser.png]]

By default  you are redirected to  "user-friendly" page that enables  to compose
API request and to select HTTP methods such as {GET, POST, PUT, DELETE, OPTION}.

Note that  adding "/?format=json" after the  URL redirects you to  the "classic"
API output, as illustred with the following example:

[[./docs/sites_browser_classic.png]]

*** Command line

You can also access API with tools such as *curl*:

#+BEGIN_src shell
curl http://127.0.0.1:8000/sites
#+END_src

it leads to the following ouput:

#+BEGIN_src shell
[{"id":1,"name":"KVM@TACC","os_auth_url":"https://openstack.tacc.chameleoncloud.org:5000/v2.0","cluster_ids":[]}]
#+END_src

** Creating an Hadoop job
*** Send files to the remote filesystem

curl -H "Content-Type: application/json" -X POST -d '{"name":"myfile.txt"}' http://localhost:8000/files

curl -i -X POST -F 'data=@vanilla.js' http://localhost:8000/set_file_content/1/

curl -i -X POST  http://localhost:8000/put_local_file_to_hdfs/1/hdfsmyfile/

*** Create and run an Hadoop job

** Classes accessibles from API

The following diagram illustrates classes that can be manipulated by the API.

[[./docs/classes.png]]

*** User

| URL         | HTTP Method | Action            | Supported | Comment |
|-------------+-------------+-------------------+-----------+---------|
| /users/     | GET         | list all users    | Yes       |         |
| /users/     | POST        | add a new user    | Yes       |         |
| /users/[id] | GET         | details of a user | Yes       |         |
| /users/[id] | PUT         | update a user     | Yes       |         |
| /users/[id] | DELETE      | delete a user     | Yes       |         |

*** Site

| URL         | HTTP Method | Action            | Supported | Comment |
|-------------+-------------+-------------------+-----------+---------|
| /sites/     | GET         | list all   sites  | Yes       |         |
| /sites/     | POST        | add a new site    | Yes       |         |
| /sites/[id] | GET         | details of a site | Yes       |         |
| /sites/[id] | PUT         | update a site     | Yes       |         |
| /sites/[id] | DELETE      | delete a site     | Yes       |         |

*** Cluster

| URL            | HTTP Method | Action               | Supported | Comment                    |
|----------------+-------------+----------------------+-----------+----------------------------|
| /clusters/     | GET         | list all clusters    | Yes       |                            |
| /clusters/     | POST        | add a new cluster    | Yes       |                            |
| /clusters/[id] | GET         | details of a cluster | Yes       |                            |
| /clusters/[id] | PUT         | update a cluster     | Yes       |                            |
| /clusters/[id] | DELETE      | delete a cluster     | No        | Don't delete instances yet |

*** Host

| URL         | HTTP Method | Action            | Supported | Comment                          |
|-------------+-------------+-------------------+-----------+----------------------------------|
| /hosts/     | GET         | list all  hosts   | Yes       |                                  |
| /hosts/     | POST        | add a new host    | Yes       |                                  |
| /hosts/[id] | GET         | details of a host | Yes       |                                  |
| /hosts/[id] | PUT         | update a host     | Yes       |                                  |
| /hosts/[id] | DELETE      | delete a host     | No        | Don't delete the linked instance |

*** Software

| URL             | HTTP Method | Action                | Supported | Comment |
|-----------------+-------------+-----------------------+-----------+---------|
| /softwares/     | GET         | list all softwares    | Yes       |         |
| /softwares/     | POST        | add a new software    | Yes       |         |
| /softwares/[id] | GET         | details of a software | Yes       |         |
| /softwares/[id] | PUT         | update a software     | Yes       |         |
| /softwares/[id] | DELETE      | delete a software     | Yes       |         |

** Architecture
[[./docs/architecture.png]]
** Contact

jpastor@uchicago.edu
